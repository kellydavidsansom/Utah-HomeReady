<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | Utah Home Ready Check</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .admin-nav { background: var(--dark); padding: 15px 0; }
        .admin-nav .container { display: flex; justify-content: space-between; align-items: center; }
        .admin-nav a { color: white; text-decoration: none; margin-right: 20px; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .detail-section { background: var(--white); padding: 20px; border-radius: 8px; }
        .detail-section h3 { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--bg); }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: var(--gray); }
        .status-badge { display: inline-block; padding: 8px 20px; border-radius: 20px; font-weight: 600; color: white; }
        .status-badge.green { background: var(--green); }
        .status-badge.yellow { background: var(--yellow); }
        .status-badge.red { background: var(--red); }
    </style>
</head>
<body>
    <nav class="admin-nav">
        <div class="container">
            <div>
                <a href="/admin/dashboard"><strong>Admin</strong></a>
                <a href="/admin/leads">Leads</a>
                <a href="/admin/agents">Agents</a>
            </div>
            <a href="/admin/logout">Logout</a>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <div>
                    <h1><%= lead.first_name %> <%= lead.last_name %></h1>
                    <% if (lead.readiness_level) { %>
                        <span class="status-badge <%= lead.readiness_level %>"><%= lead.readiness_level.toUpperCase() %> - Score: <%= lead.readiness_score %></span>
                    <% } %>
                </div>
                <div>
                    <% if (lead.google_drive_folder_id) { %>
                        <a href="https://drive.google.com/drive/folders/<%= lead.google_drive_folder_id %>" class="btn btn-primary" target="_blank">Open Drive Folder</a>
                    <% } %>
                    <a href="/results/<%= lead.id %>" class="btn btn-outline" target="_blank">View Results</a>
                    <a href="/admin/leads/<%= lead.id %>/mismo" class="btn btn-secondary">Download MISMO</a>
                </div>
            </div>

            <div class="detail-grid">
                <div class="detail-section">
                    <h3>Contact Info</h3>
                    <div class="detail-row"><span class="detail-label">Email</span><span><%= lead.email %></span></div>
                    <div class="detail-row"><span class="detail-label">Phone</span><span><%= lead.phone || '-' %></span></div>
                    <div class="detail-row"><span class="detail-label">Address</span><span><%= lead.street_address %>, <%= lead.city %>, <%= lead.state %> <%= lead.zip %></span></div>
                    <div class="detail-row"><span class="detail-label">Time at Address</span><span><%= lead.time_at_address %></span></div>
                </div>

                <div class="detail-section">
                    <h3>Financial Info</h3>
                    <div class="detail-row"><span class="detail-label">Gross Income</span><span>$<%= (lead.gross_annual_income || 0).toLocaleString() %></span></div>
                    <% if (lead.has_coborrower) { %>
                        <div class="detail-row"><span class="detail-label">Co-Borrower Income</span><span>$<%= (lead.coborrower_gross_annual_income || 0).toLocaleString() %></span></div>
                    <% } %>
                    <div class="detail-row"><span class="detail-label">Employment</span><span><%= lead.employment_type %></span></div>
                    <div class="detail-row"><span class="detail-label">Monthly Debts</span><span><%= lead.monthly_debt_payments %></span></div>
                    <div class="detail-row"><span class="detail-label">Credit Score</span><span><%= lead.credit_score_range %></span></div>
                    <div class="detail-row"><span class="detail-label">Down Payment</span><span>$<%= (lead.down_payment_saved || 0).toLocaleString() %></span></div>
                </div>

                <div class="detail-section">
                    <h3>Affordability</h3>
                    <div class="detail-row" style="color: var(--green);"><span>Comfortable</span><span>$<%= (lead.comfortable_price || 0).toLocaleString() %></span></div>
                    <div class="detail-row" style="color: var(--yellow);"><span>Stretch</span><span>$<%= (lead.stretch_price || 0).toLocaleString() %></span></div>
                    <div class="detail-row" style="color: var(--red);"><span>Strained</span><span>$<%= (lead.strained_price || 0).toLocaleString() %></span></div>
                </div>

                <div class="detail-section">
                    <h3>Buying Plans</h3>
                    <div class="detail-row"><span class="detail-label">Timeline</span><span><%= lead.timeline %></span></div>
                    <div class="detail-row"><span class="detail-label">Counties</span><span><%= targetCounties.join(', ') || '-' %></span></div>
                    <div class="detail-row"><span class="detail-label">First-Time Buyer</span><span><%= lead.first_time_buyer %></span></div>
                    <div class="detail-row"><span class="detail-label">VA Eligible</span><span><%= lead.va_eligible %></span></div>
                    <div class="detail-row"><span class="detail-label">Current Housing</span><span><%= lead.current_housing %></span></div>
                </div>
            </div>

            <% if (lead.preapproval_submitted) { %>
                <h2 style="margin-top: 40px; margin-bottom: 20px;">Pre-Approval Application</h2>
                <p style="color: var(--gray); margin-bottom: 20px;">Submitted: <%= lead.preapproval_submitted_at ? new Date(lead.preapproval_submitted_at).toLocaleString() : 'N/A' %></p>

                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>Identity</h3>
                        <div class="detail-row"><span class="detail-label">Date of Birth</span><span><%= lead.date_of_birth || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Citizenship</span><span><%= lead.citizenship_status || '-' %></span></div>
                    </div>

                    <div class="detail-section">
                        <h3>Employment Details</h3>
                        <div class="detail-row"><span class="detail-label">Employer</span><span><%= lead.employer_name || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Employer Address</span><span><%= lead.employer_address || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Job Title</span><span><%= lead.job_title || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Years at Job</span><span><%= lead.years_at_job || '-' %></span></div>
                        <% if (lead.previous_employer_name) { %>
                            <div class="detail-row"><span class="detail-label">Previous Employer</span><span><%= lead.previous_employer_name %></span></div>
                            <div class="detail-row"><span class="detail-label">Previous Employer Years</span><span><%= lead.previous_employer_years || '-' %></span></div>
                        <% } %>
                    </div>

                    <div class="detail-section">
                        <h3>Financial Details</h3>
                        <div class="detail-row"><span class="detail-label">Monthly Income</span><span>$<%= (lead.monthly_income || 0).toLocaleString() %></span></div>
                        <div class="detail-row"><span class="detail-label">Other Income</span><span>$<%= (lead.other_income_amount || 0).toLocaleString() %></span></div>
                        <% if (lead.other_income_source) { %>
                            <div class="detail-row"><span class="detail-label">Other Income Source</span><span><%= lead.other_income_source %></span></div>
                        <% } %>
                        <div class="detail-row"><span class="detail-label">Current Housing Payment</span><span>$<%= (lead.current_housing_payment || 0).toLocaleString() %></span></div>
                        <div class="detail-row"><span class="detail-label">Monthly Debt Payments</span><span>$<%= (lead.monthly_debt_amount || 0).toLocaleString() %></span></div>
                    </div>

                    <div class="detail-section">
                        <h3>Assets</h3>
                        <div class="detail-row"><span class="detail-label">Checking Balance</span><span>$<%= (lead.checking_balance || 0).toLocaleString() %></span></div>
                        <div class="detail-row"><span class="detail-label">Savings Balance</span><span>$<%= (lead.savings_balance || 0).toLocaleString() %></span></div>
                        <div class="detail-row"><span class="detail-label">Retirement Balance</span><span>$<%= (lead.retirement_balance || 0).toLocaleString() %></span></div>
                        <div class="detail-row"><span class="detail-label">Other Assets</span><span>$<%= (lead.other_assets_balance || 0).toLocaleString() %></span></div>
                        <% if (lead.other_assets_description) { %>
                            <div class="detail-row"><span class="detail-label">Other Assets Desc</span><span><%= lead.other_assets_description %></span></div>
                        <% } %>
                    </div>

                    <div class="detail-section">
                        <h3>Liabilities & History</h3>
                        <div class="detail-row"><span class="detail-label">Pays Alimony/Child Support</span><span><%= lead.pays_alimony_child_support || '-' %></span></div>
                        <% if (lead.alimony_amount) { %>
                            <div class="detail-row"><span class="detail-label">Alimony Amount</span><span>$<%= (lead.alimony_amount || 0).toLocaleString() %>/mo</span></div>
                        <% } %>
                        <div class="detail-row"><span class="detail-label">Bankruptcy (7 yrs)</span><span><%= lead.has_bankruptcy || '-' %></span></div>
                        <% if (lead.bankruptcy_details) { %>
                            <div class="detail-row"><span class="detail-label">Bankruptcy Details</span><span><%= lead.bankruptcy_details %></span></div>
                        <% } %>
                        <div class="detail-row"><span class="detail-label">Foreclosure (7 yrs)</span><span><%= lead.has_foreclosure || '-' %></span></div>
                        <% if (lead.foreclosure_details) { %>
                            <div class="detail-row"><span class="detail-label">Foreclosure Details</span><span><%= lead.foreclosure_details %></span></div>
                        <% } %>
                        <div class="detail-row"><span class="detail-label">Judgments/Liens</span><span><%= lead.has_judgments_liens || '-' %></span></div>
                        <% if (lead.judgments_details) { %>
                            <div class="detail-row"><span class="detail-label">Judgments Details</span><span><%= lead.judgments_details %></span></div>
                        <% } %>
                    </div>

                    <div class="detail-section">
                        <h3>Property Intent</h3>
                        <div class="detail-row"><span class="detail-label">Property Type</span><span><%= lead.property_type || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Property Use</span><span><%= lead.property_use || '-' %></span></div>
                        <div class="detail-row"><span class="detail-label">Has Property in Mind</span><span><%= lead.has_property_in_mind || '-' %></span></div>
                        <% if (lead.property_address) { %>
                            <div class="detail-row"><span class="detail-label">Property Address</span><span><%= lead.property_address %></span></div>
                        <% } %>
                    </div>
                </div>

                <% if (typeof documents !== 'undefined' && documents && documents.length > 0) { %>
                    <div class="detail-section mt-3">
                        <h3>Uploaded Documents</h3>
                        <% documents.forEach(function(doc) { %>
                            <div class="detail-row">
                                <span class="detail-label"><%= doc.document_type %></span>
                                <span>
                                    <% if (doc.google_drive_url) { %>
                                        <a href="<%= doc.google_drive_url %>" target="_blank"><%= doc.file_name %></a>
                                    <% } else { %>
                                        <%= doc.file_name %>
                                    <% } %>
                                </span>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            <% } %>

            <% if (lead.ai_summary) { %>
                <div class="detail-section mt-3">
                    <h3>AI Summary</h3>
                    <p><%= lead.ai_summary %></p>
                </div>
            <% } %>
        </div>
    </main>
</body>
</html>
